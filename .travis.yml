language: cpp
osx_image: xcode8
os:
  - linux
  - osx
branches:
  only:
  - master
git:
  depth: 50000
compiler:
  - gcc
dist: trusty
sudo: required
addons:
  apt:
    sources:
    - ubuntu-toolchain-r-test
    packages:
    - gcc-6
    - g++-6
    - gcc-multilib
    - g++-multilib
    - gcc-6-multilib
    - g++-6-multilib	
    - linux-libc-dev
    - p7zip-full
    
script: 
  - cd ./Build/
  - if [ "$TRAVIS_OS_NAME" == "linux" ]; then ./Build.Linux.sh; fi
  - if [ "$TRAVIS_OS_NAME" == "osx" ]; then ./Build.MacOS.sh; fi
  - cd ./../
before_script:
  - if [ "$TRAVIS_TAG" == "" ]; then export MB_BUILD_VERSION=99.99; fi
  - if [ "$TRAVIS_TAG" != "" ]; then export MB_BUILD_VERSION=$TRAVIS_TAG; fi
  - if [ "$TRAVIS_OS_NAME" == "linux" ]; then 7z a -tzip -r "MicroBuild-Linux-$MB_BUILD_VERSION.zip" ".\\Build\\" ".\\Docs\\" ".\\Plugins\\" ".\\Source\\" ".\\Tests\\" ".\\LICENCE.md" ".\\README.md"; fi
  - if [ "$TRAVIS_OS_NAME" == "osx" ]; then 7z a -tzip -r "MicroBuild-MacOS-$MB_BUILD_VERSION.zip" ".\\Build\\" ".\\Docs\\" ".\\Plugins\\" ".\\Source\\" ".\\Tests\\" ".\\LICENCE.md" ".\\README.md"; fi
after_success: 
  - if [ "$TRAVIS_OS_NAME" == "linux" ]; then 7z a -tzip -r "MicroBuild-Linux-$MB_BUILD_VERSION.zip" "Binaries\\Linux\\Shipping_x64\\*"; fi
  - if [ "$TRAVIS_OS_NAME" == "linux" ]; then 7z a -tzip -r "MicroBuild-Linux-$MB_BUILD_VERSION.zip" "Binaries\\Linux\\Shipping_x86\\*"; fi
  - if [ "$TRAVIS_OS_NAME" == "osx" ]; then 7z a -tzip -r "MicroBuild-MacOS-$MB_BUILD_VERSION.zip" "Binaries\\MacOS\Shipping_x64\\*"; fi
  - if [ "$TRAVIS_OS_NAME" == "osx" ]; then 7z a -tzip -r "MicroBuild-MacOS-$MB_BUILD_VERSION.zip" "Binaries\\MacOS\Shipping_x86\\*"; fi
deploy:
  provider: releases
  api_key: 
    secure: $GITHUB_TOKEN
  file: 
    - if [ "$TRAVIS_OS_NAME" == "linux" ]; then MicroBuild-Linux-$MB_BUILD_VERSION.zip; fi
    - if [ "$TRAVIS_OS_NAME" == "osx" ]; then MicroBuild-MacOS-$MB_BUILD_VERSION.zip; fi
  skip_cleanup: true
  on:
    tags: true