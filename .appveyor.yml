os: Visual Studio 2015

platform:
  - Win32
  - x64

configuration:
  - Shipping

before_build:
  - cd Build
  - Generate.Windows.bat
  - cd ..

build:
  project: Build\ProjectFiles\MicroBuild.sln

on_success: 
  - ps: if ($env:PLATFORM -eq "x64")   { cp ./Build/ProjectFiles/MicroBuild-Core/Obj/x64/Shipping/MicroBuild-Core.pdb ./Binaries/Windows_x64/MicroBuild-Core.pdb }
  - ps: if ($env:PLATFORM -eq "Win32") { cp ./Build/ProjectFiles/MicroBuild-Core/Obj/x86/Shipping/MicroBuild-Core.pdb ./Binaries/Windows_x86/MicroBuild-Core.pdb }
  - ps: if ($env:PLATFORM -eq "x64")   { cp ./Build/ProjectFiles/MicroBuild-Core/Obj/x64/Shipping/MicroBuild-Schemas.pdb ./Binaries/Windows_x64/MicroBuild-Schemas.pdb }
  - ps: if ($env:PLATFORM -eq "Win32") { cp ./Build/ProjectFiles/MicroBuild-Core/Obj/x86/Shipping/MicroBuild-Schemas.pdb ./Binaries/Windows_x86/MicroBuild-Schemas.pdb }
  - ps: if ($env:PLATFORM -eq "x64")   { cp ./Build/ProjectFiles/MicroBuild-ZLib/Obj/x64/Shipping/MicroBuild-ZLib.pdb ./Binaries/Windows_x64/MicroBuild-Zlib.pdb }
  - ps: if ($env:PLATFORM -eq "Win32") { cp ./Build/ProjectFiles/MicroBuild-ZLib/Obj/x86/Shipping/MicroBuild-ZLib.pdb ./Binaries/Windows_x86/MicroBuild-Zlib.pdb }
  - git config --global user.email "buildserver@programmingbytim.com"
  - git config --global user.name "Build Server"
  - ps: if ($env:PLATFORM -eq "x64")   { git add ./Binaries/Windows_x64/MicroBuild.exe }
  - ps: if ($env:PLATFORM -eq "x64")   { git add ./Binaries/Windows_x64/MicroBuild.pdb }
  - ps: if ($env:PLATFORM -eq "Win32") { git add ./Binaries/Windows_x86/MicroBuild.exe }
  - ps: if ($env:PLATFORM -eq "Win32") { git add ./Binaries/Windows_x86/MicroBuild.pdb }
  - ps: if ($env:PLATFORM -eq "x64")   { git add ./Binaries/Windows_x64/MicroBuild-Core.lib }
  - ps: if ($env:PLATFORM -eq "x64")   { git add ./Binaries/Windows_x64/MicroBuild-Core.pdb }
  - ps: if ($env:PLATFORM -eq "Win32") { git add ./Binaries/Windows_x86/MicroBuild-Core.lib }
  - ps: if ($env:PLATFORM -eq "Win32") { git add ./Binaries/Windows_x86/MicroBuild-Core.pdb }
  - ps: if ($env:PLATFORM -eq "x64")   { git add ./Binaries/Windows_x64/MicroBuild-Schemas.lib }
  - ps: if ($env:PLATFORM -eq "x64")   { git add ./Binaries/Windows_x64/MicroBuild-Schemas.pdb }
  - ps: if ($env:PLATFORM -eq "Win32") { git add ./Binaries/Windows_x86/MicroBuild-Schemas.lib }
  - ps: if ($env:PLATFORM -eq "Win32") { git add ./Binaries/Windows_x86/MicroBuild-Schemas.pdb }
  - ps: if ($env:PLATFORM -eq "x64")   { git add ./Binaries/Windows_x64/MicroBuild-ZLib.lib }
  - ps: if ($env:PLATFORM -eq "x64")   { git add ./Binaries/Windows_x64/MicroBuild-ZLib.pdb }
  - ps: if ($env:PLATFORM -eq "Win32") { git add ./Binaries/Windows_x86/MicroBuild-ZLib.lib }
  - ps: if ($env:PLATFORM -eq "Win32") { git add ./Binaries/Windows_x86/MicroBuild-ZLib.pdb }
  - git checkout %APPVEYOR_REPO_BRANCH%
  - git pull --no-edit --no-commit
  - git commit -m "[ci skip] Automated Build (Appveyor build %APPVEYOR_BUILD_NUMBER%)."
  - git push "https://TLeonardUK:%GITHUB_TOKEN%@github.com/TLeonardUK/MicroBuild.git" --all --quiet
